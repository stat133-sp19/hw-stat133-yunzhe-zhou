"0","#calculate the coverage probability for eIC"
"0","times=500"
"0","count=0"
"0","for(r in 1:times)"
"0","{"
"0"," #eIC"
"0","# Initialize a linear model"
"0","# y:1*1 x:1*q b(beta):q*1 res(residual):1*1"
"0","n=500"
"0","q=5"
"0","# set b(beta)"
"0","set.seed(3*r+1000)"
"0","b=runif(q,-2,2)"
"0","b=t(t(b))"
"0","# set X,Y,res"
"0","X=matrix(data = NA, nrow = n, ncol = q)"
"0","Y=matrix(data = NA, nrow = n, ncol = 1)"
"0","for(i in 1:n)"
"0","{"
"0","  X[i,]=runif(q,0,10)"
"0","}"
"0","res=c()"
"0","k=0.5"
"0","for(i in 1:n)"
"0","{"
"0","  res[i]=rnorm(1,0,abs(k*mean(X[i,])))"
"0","}"
"0","res=t(t(res))"
"0","Y=X%*%b+res"
"0","#least square estimator and relative influence curve"
"0","#least square estimator b_l"
"0","library(matlib)"
"0","b_l=inv(t(X)%*%X)%*%t(X)%*%Y"
"0","#calculate eIC"
"0","normalize=matrix(data = NA,nrow=q,ncol=q)"
"0","for(i in 1:q)"
"0","{"
"0","  for(j in 1:q)"
"0","  {"
"0","    normalize[i,j]=0"
"0","  }"
"0","}"
"0","for(i in 1:n)"
"0","{"
"0","  x=X[i,]"
"0","  y=Y[i,]"
"0","  x=t(x)"
"0","  y=t(y)"
"0","  normalize=normalize+t(x)%*%(1/(k*mean(x)))%*%x"
"0","}"
"0","normalize=normalize/n"
"0","normalize=t(normalize)"
"0","eIC=matrix(data=NA,nrow=q,ncol=n)"
"0","for(i in 1:n)"
"0","{"
"0","  x=X[i,]"
"0","  y=Y[i,]"
"0","  x=t(x)"
"0","  y=t(y)"
"0","  eIC[,i]=inv(normalize)%*%t(x)%*%(1/(k*mean(x)))%*%(y-x%*%b_l)"
"0","}"
"0","#one step estimator"
"0","b_e=b_l+mean(eIC)"
"0","#calculate the p value for eIC"
"0","eIC=matrix(data=NA,nrow=q,ncol=n)"
"0","for(i in 1:n)"
"0","{"
"0","  x=X[i,]"
"0","  y=Y[i,]"
"0","  x=t(x)"
"0","  y=t(y)"
"0","  eIC[,i]=inv(normalize)%*%t(x)%*%(1/(k*mean(x)))%*%(y-x%*%b_e)"
"0","}"
"0","eIC=t(eIC)"
"0","Cov=cov(eIC)"
"0","Cor=cor(eIC)"
"0","SE=sqrt(diag(Cov)/n)"
"0","draw=abs(rmvnorm(10000,rep(0,q),Cor))"
"0","max_draw=apply(draw,1,max)"
"0","q_value=quantile(max_draw,probs=0.95)"
"0","q_value"
"0","#calculate the 95% confidence interval for eIC"
"0","einterval_up=b_e+q_value*SE"
"0","einterval_down=b_e-q_value*SE"
"0","c=0"
"0","for(t in 1:q)"
"0","{"
"0","  if(b[t]>einterval_up[t] | b[t]<einterval_down[t])"
"0","  {"
"0","    c=1"
"0","  }"
"0","}"
"0","count=count+c"
"0","}"

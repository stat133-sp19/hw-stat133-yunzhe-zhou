"0","library(dplyr)"
"0","o=data.frame(w,a,y)"
"0","o_1=o"
"0","o_0=o"
"0","o_1$a=1"
"0","o_0$a=0"
"0","multiply=w*a"
"0","Q=glm(y~a+w+multiply,data=o,family=""binomial"")"
"0","g=glm(a~w,data=o,family=""binomial"")"
"0","QAW=predict(Q,type=""response"")"
"0","Q0W=predict(Q,newdata=o_0,type=""response"")"
"0","Q1W=predict(Q,newdata=o_1,type=""response"")"
"0","g_n=predict(g,type=""response"")"
"0","g0_n=function(a,w)"
"0","{"
"0","  l=length(w)"
"0","  coef=g$coefficients"
"0","  result=coef[1]+coef[2]*w"
"0","  result=1/(1+exp(-w))"
"0","  for(i in 1:l)"
"0","  {"
"0","    if(a[i]==0)"
"0","    {"
"0","      result[i]=1-result[i]"
"0","    }"
"0","  }"
"0","  return(result)"
"0","  "
"0","}"
"0","psai=mean(y*g_1(a,w)/g0_n(a,w))"
"0","one_psai=mean(Q0W*g_1(a0,w)+Q1W*g_1(a1,w)+g_1(a,w)/g0_n(a,w)*(y-QAW))"
"0","IC=Q0W*g_1(a0,w)+Q1W*g_1(a1,w)-one_psai+g_1(a,w)/g0_n(a,w)*(y-QAW)"
"0","var=var(IC)"
"0","interval=1.96*sqrt(var(IC)/n)"
"0","up_interval=one_psai+interval"
"0","down_interval=one_psai-interval"
"0","table=data.frame(psai0,one_psai,var,down_interval,up_interval)"

"0","interval=c()"
"0","up_interval=c()"
"0","down_interval=c()"
"0","psai=c()"
"0","one_psai=c()"
"0","count=0"
"0","times=1000"
"0","psai0=0.084324089"
"0","for(t in 1:times)"
"0","{"
"0","library(gtools)"
"0","set.seed(t)"
"0","n=1000"
"0","w=runif(n,-1,1)"
"0","a=c()"
"0","y=c()"
"0","a0=rep(0,n)"
"0","a1=rep(1,n)"
"0","inv_w=inv.logit(w)"
"0","for(i in 1:n)"
"0","{"
"0","  a[i]=sample(c(0,1),1,prob = c(1-inv_w[i],inv_w[i]))"
"0","  p=-3+a[i]-0.5*w[i]+0.25*a[i]*w[i]"
"0","  p=inv.logit(p)"
"0","  y[i]=sample(c(0,1),1,prob = c(1-p,p))"
"0","}"
"0","g_1=function(a,w)"
"0","{"
"0","  l=length(w)"
"0","  result=1/(1+exp(-w))"
"0","  for(i in 1:l)"
"0","  {"
"0","    if(a[i]==0)"
"0","    {"
"0","      result[i]=1-result[i]"
"0","    }"
"0","  }"
"0","  return(result)"
"0","  "
"0","}"
"0","library(dplyr)"
"0","o=data.frame(w,a,y)"
"0","o_1=o"
"0","o_0=o"
"0","o_1$a=1"
"0","o_0$a=0"
"0","multiply=w*a"
"0","Q=glm(y~a+w+multiply,data=o,family=""binomial"")"
"0","g=glm(a~w,data=o,family=""binomial"")"
"0","QAW=predict(Q,type=""response"")"
"0","Q0W=predict(Q,newdata=o_0,type=""response"")"
"0","Q1W=predict(Q,newdata=o_1,type=""response"")"
"0","g_n=predict(g,type=""response"")"
"0","g0_n=function(a,w)"
"0","{"
"0","  l=length(w)"
"0","  coef=g$coefficients"
"0","  result=coef[1]+coef[2]*w"
"0","  result=1/(1+exp(-w))"
"0","  for(i in 1:l)"
"0","  {"
"0","    if(a[i]==0)"
"0","    {"
"0","      result[i]=1-result[i]"
"0","    }"
"0","  }"
"0","  return(result)"
"0","  "
"0","}"
"0","psai[t]=mean(y*g_1(a,w)/g0_n(a,w))"
"0","one_psai[t]=mean(Q0W*g_1(a0,w)+Q1W*g_1(a1,w)+g_1(a,w)/g0_n(a,w)*(y-QAW))"
"0","IC=Q0W*g_1(a0,w)+Q1W*g_1(a1,w)-one_psai[t]+g_1(a,w)/g0_n(a,w)*(y-QAW)"
"0","interval[t]=1.96*sqrt(var(IC)/n)"
"0","up_interval[t]=one_psai[t]+interval[t]"
"0","down_interval[t]=one_psai[t]-interval[t]"
"0","if(psai0<down_interval[t] | psai0>up_interval[t])"
"0","{"
"0","  count=count+1"
"0","}"
"0","}"
